Evasive Process Hollowing

Overview
This **C program** implements a **process hollowing** technique designed to **evade static scans** by Endpoint Detection and Response (EDR) systems. It creates a **suspended process**, **injects encrypted shellcode**, and modifies the **thread context** to execute the shellcode. The program uses techniques like **shellcode encryption**, **dynamic API resolution**, and **string obfuscation** to reduce detection by **static analysis tools**.

Features
- **Process Hollowing**: Creates a target process (e.g., `notepad.exe`) in a **suspended state**, allocates memory, injects shellcode, and updates the thread's **instruction pointer**.
- **Shellcode Encryption**: Uses **XOR-encrypted shellcode** to avoid static signature detection.
- **Dynamic API Resolution**: Resolves **Windows API functions** at runtime to obscure imports.
- **String Obfuscation**: Encrypts the **target process path** to avoid string-based detection.
- **Error Handling**: Includes checks for **API failures** and **memory allocation issues**.

Prerequisites
- A **C compiler** (e.g., MSVC, gcc).
- **Windows environment** (for Windows API functions).
- **Encrypted shellcode** and **target path arrays** generated by the XOR encryption utility.
- Basic understanding of **process injection** and **Windows internals**.

Usage

Compilation
Compile the program using a **C compiler**. Examples:
- **MSVC**: `cl evasive_process_hollowing.c`
- **gcc**: `gcc evasive_process_hollowing.c -o evasive_process_hollowing`

Input
The program requires:
- **Encrypted Shellcode**: An **XOR-encrypted shellcode** array (e.g., `EncryptedShellcode`).
- **Encrypted Target Path**: An **XOR-encrypted wide string** for the target process path (e.g., `EncryptedTargetPath`).
- **XOR Key**: The decryption key (`0x5A`) matching the **encryption utility**.

To prepare inputs:

Use the XOR encryption utility (xor_encrypt.c) to generate EncryptedShellcode and EncryptedTargetPath.
Replace the EncryptedShellcode and EncryptedTargetPath arrays in the program with the generated arrays.
Ensure the XOR_KEY (0x5A) matches the encryption key used.

Running the Program
Execute the compiled program:
```bash
./evasive_process_hollowing
```

The program will:

Decrypt the target process path and shellcode.
Create a suspended process (e.g., notepad.exe).
Allocate memory in the target process.
Write the decrypted shellcode to the allocated memory.
Update the thread context to execute the shellcode.
Resume the thread to run the injected code.

Example
The program creates a `notepad.exe` process, injects a **calculator shellcode**, and executes it. The output will show the **process ID** and any **errors** encountered during execution.

Code Structure
- **DecryptShellcode**: Decrypts the **XOR-encrypted shellcode** at runtime.
- **DecryptString**: Decrypts the **XOR-encrypted target process path**.
- **GetFunctionAddress**: Resolves **Windows API functions** dynamically using `GetProcAddress`.
- **main**: Orchestrates **process creation**, **memory allocation**, **shellcode injection**, and **thread execution**.

Notes
- **Shellcode**: The provided `EncryptedShellcode` is **partial**. Use the **XOR encryption utility** to encrypt your full shellcode.
- **Evasion**: The program uses **encryption**, **dynamic API resolution**, and **process hollowing** to evade **static EDR scans**. **Dynamic analysis** may still detect the behavior.
- **Limitations**: Advanced EDRs may detect **memory allocation** or **thread context modifications**. Consider additional evasion techniques like **syscalls** or **anti-debugging**.
- **XOR Key**: The default key is `0x5A`. Use a **random key** for better evasion.

Testing
- Test in a **controlled environment** (e.g., a virtual machine) to verify functionality.
- Use the **XOR encryption utility** to generate encrypted inputs.
- Check if the binary is flagged by **static analysis tools** (e.g., `PEiD`, `Detect It Easy`, VirusTotal).
- Monitor **EDR logs** to assess detection during execution.

Future Improvements
- Use **direct syscalls** (e.g., `NtWriteVirtualMemory`) to bypass **API hooking**.
- Implement **polymorphic shellcode** to avoid signature detection.
- Add **anti-debugging checks** (e.g., `IsDebuggerPresent`).
- **Randomize** the XOR key per build or at runtime.

Legal and Ethical Considerations
This tool is for **educational and research purposes only**. Ensure compliance with all applicable **laws** and **ethical guidelines** when using this code, especially in security research involving **EDR evasion** or **process injection**.

Contact
For questions or contributions, please contact the project maintainer or open an issue on the GitHub repository.
